language: python

git:
  depth: 1

env:
 global:
  - GH_REF: "github.com/NewFuture/NKUWLAN.git"
  - BUILD_PATH: "build/"
  - NAME: "From Travis CI"
  - EMAIL: "github@newfuture.cc"
  - emojis: "(ðŸ¶ ðŸº ðŸ± ðŸ­ ðŸ¹ ðŸ° ðŸ¸ ðŸ¯ ðŸ¨ ðŸ» ðŸ· ðŸ® ðŸµ ðŸ¼ ðŸ§ ðŸ ðŸ¢ ðŸ™ ðŸ  ðŸ³ ðŸ¬ ðŸ¥)"

before_script:
  - git clone --depth=1 -b build "https://${GH_REF}"  ${BUILD_PATH}

script:
  - python build.py ${BUILD_PATH}nkuwlan.py
  # compile to check syntax
  - python -m py_compile ${BUILD_PATH}nkuwlan.py

after_success:
  - echo $RSAKEY>~/.ssh/id_rsa
  - chmod 600 ~/.ssh/id_rsa
  - cd  ${BUILD_PATH}
  - git commit -am "${emojis[$RANDOM % 22]} Auto build from master" --author="$NAME <$EMAIL>"
  - git push -f "https://${GH_TOKEN}@${GH_REF}" build:build

branches:
  only:
    - master
